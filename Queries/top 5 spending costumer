SELECT D.customer_id, D.first_name, D.last_name, A.country, B.city, SUM(E.amount) AS total_amount_paid	
FROM customer D	
JOIN address C ON D.address_id = C.address_id	
JOIN city B ON C.city_id = B.city_id	
JOIN country A ON B.country_id = A.country_id	
JOIN payment E ON D.customer_id = E.customer_id	
WHERE B.city_id IN(	
	SELECT B.city_id
	FROM customer D
	JOIN address C ON D.address_id = C.address_id
	JOIN city B ON C.city_id = B.city_id
	GROUP BY B.city_id
	ORDER BY COUNT(D.customer_id) DESC
	Limit 10
)	
GROUP BY D.customer_id, D.first_name, D.last_name, A.country, B.city	
ORDER BY total_amount_paid DESC	
Limit 5;	
